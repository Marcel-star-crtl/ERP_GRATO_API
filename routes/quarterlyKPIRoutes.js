const express = require('express');
const router = express.Router();
const { authMiddleware, requireRoles } = require('../middlewares/authMiddleware');
const quarterlyKPIController = require('../controllers/quarterlyKPIController');

// Get default criteria
router.get(
  '/approved-for-linking',
  authMiddleware,
  quarterlyKPIController.getApprovedKPIsForTaskLinking
);

// Get pending approvals (supervisors)
router.get(
  '/pending-approvals',
  authMiddleware,
  requireRoles('employee', 'supervisor', 'admin', 'finance', 'it', 'hr', 'supply_chain', 'technical'),
  quarterlyKPIController.getPendingKPIApprovals
);

// Get employee KPIs
router.get(
  '/my-kpis',
  authMiddleware,
  quarterlyKPIController.getEmployeeKPIs
);

// Get single KPI
router.get(
  '/:id',
  authMiddleware,
  quarterlyKPIController.getKPIById
);

// Create or update KPIs
router.post(
  '/',
  authMiddleware,
  quarterlyKPIController.createOrUpdateKPIs
);

// Submit for approval
router.post(
  '/:id/submit',
  authMiddleware,
  quarterlyKPIController.submitKPIsForApproval
);

// Approve/reject KPIs
router.post(
  '/:id/approve',
  authMiddleware,
  requireRoles('employee', 'supervisor', 'admin', 'finance', 'it', 'hr', 'supply_chain', 'technical'),
  quarterlyKPIController.processKPIApproval
);

// Delete KPIs
router.delete(
  '/:id',
  authMiddleware,
  quarterlyKPIController.deleteKPIs
);

module.exports = router;